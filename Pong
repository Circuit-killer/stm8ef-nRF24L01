NVM
variable mycount
variable bigcount
5 constant _LED \ Led connected to port B, Pin 5
$5005 constant PB_ODR
$5007 constant PB_DDR
$5008 constant PB_CR1
: Setup_B
   Bit5 PB_DDR c! \ Port B outputs
   Bit5 PB_CR1 c! \ set up as push pull outputs
;
: LED.On ( -- )  [ 0 PB_ODR _LED ]B! ;
: LED.Off ( -- ) [ 1 PB_ODR _LED ]B! ;
: FlashLed  LED.ON 2ms LED.Off   
;

: PAYLOAD.RX ( ---- n1 n2 ... nn ) \ returns n bytes as set by P0_width
   begin
      rx_dr? \ wait until data is ready
   until
    >STANDBY1
   R_RX_PAYLOAD (NRF@!) \ sends command "get bytes in the payload"
   P0_width 0 do
      $ff SPI
      mybuff I + c!
   loop
   _csn.high 
   bit6 R.STATUS nRF!1 \ clears rx_dr? flag
   CLR_INT
   _CE.HD \ go back to being a RX
   ;
: TestRx
   (RX) \ now acting as a RX
   0 mycount !
   0 bigcount !
   begin
      rx_dr?
      if PAYLOAD.RX
         mybuff P0_width type cr
         Flashled
      then
      mycount @ 0= 
      if 1 bigcount +! 
      then
      1 mycount +!
      bigcount @ 150 = 
   until
   ;
: Pong
   Setup_B
   testrx
   ;
' PONG 'Boot !  
RAM
