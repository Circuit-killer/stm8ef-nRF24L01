variable mycount
variable bigcount

: BIT_RX_DR $40 ;

: PAYLOAD.RX ( ---- n1 n2 ... nn ) \ returns n bytes as set by P0_width
   begin
      rx_dr? \ wait until data is ready
   until
    >STANDBY1
   R_RX_PAYLOAD (NRF@!) \ sends command "get bytes in the payload"
   P0_width 0 do
      $FF SPI
      mybuff I + C!
   LOOP
   _csn.high
   BIT_RX_DR R.STATUS nRF!1       \ Write 1 to clear bit
   CLR_INT
   _CE.HD \ go back to being a RX
;

: TestRx
   (RX) \ now acting as a RX
   0 mycount !
   0 bigcount !
   begin
      rx_dr?
      if
         PAYLOAD.RX
         mybuff P0_width type cr
      then
   mycount @ 0=
   if
      1 bigcount +!
   then
      1 mycount +!
      bigcount @ 20 =
   until
;

